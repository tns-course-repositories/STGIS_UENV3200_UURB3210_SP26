<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2026-02-05">

<title>Class 5 Lecture Demonstration Lab: Thematic Mapping, Part II</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="c5_demo_files/libs/clipboard/clipboard.min.js"></script>
<script src="c5_demo_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="c5_demo_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="c5_demo_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="c5_demo_files/libs/quarto-html/popper.min.js"></script>
<script src="c5_demo_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="c5_demo_files/libs/quarto-html/anchor.min.js"></script>
<link href="c5_demo_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="c5_demo_files/libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="c5_demo_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="c5_demo_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="c5_demo_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<style>html{ scroll-behavior: smooth; }</style>


<link rel="stylesheet" href="c5_demo_files/styles.css">
</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#class-5-lecture-demo" id="toc-class-5-lecture-demo" class="nav-link active" data-scroll-target="#class-5-lecture-demo">Class 5 Lecture Demo</a></li>
  <li><a href="#class-4-definitions-and-themes" id="toc-class-4-definitions-and-themes" class="nav-link" data-scroll-target="#class-4-definitions-and-themes">Class 4 Definitions and Themes</a></li>
  <li><a href="#class-5-demonstration-labs-video-guides" id="toc-class-5-demonstration-labs-video-guides" class="nav-link" data-scroll-target="#class-5-demonstration-labs-video-guides">Class 5 Demonstration Labs + Video Guides:</a></li>
  <li><a href="#class-5-links" id="toc-class-5-links" class="nav-link" data-scroll-target="#class-5-links">Class 5 Links:</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Class 5 Lecture Demonstration Lab: Thematic Mapping, Part II</h1>
<p class="subtitle lead">Spring 2026 | <a href="https://courses.newschool.edu/courses/UENV3200/">UENV 3200 - CRN 11009</a> + <a href="https://courses.newschool.edu/courses/UURB3210">UURB 3210 - CRN 111008</a></p>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 5, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="class-5-lecture-demo" class="level2">
<h2 class="anchored" data-anchor-id="class-5-lecture-demo">Class 5 Lecture Demo</h2>
<section id="class-5-agenda" class="level4">
<h4 class="anchored" data-anchor-id="class-5-agenda">Class 5 Agenda:</h4>
<ul>
<li><a href="https://tns-course-repositories.github.io/STGIS_UENV3200_UURB3210_SP26/demos/c5_demo.html">Class 5 Agenda</a></li>
</ul>
</section>
</section>
<section id="class-4-definitions-and-themes" class="level2">
<h2 class="anchored" data-anchor-id="class-4-definitions-and-themes">Class 4 Definitions and Themes</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Choropleth_map">Choropleth Definition</a>:</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>A choropleth map (from Greek χῶρος “area/region” and πλῆθος “multitude”) is a type of thematic map in which areas are shaded or patterned in proportion to a statistical variable that represents an aggregate summary of a geographic characteristic within each area, such as population density or per-capita income.</p>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://i.imgur.com/3RsOh0A.png" class="img-fluid figure-img"></p>
<figcaption><em>Choropleth Example</em></figcaption>
</figure>
</div>
<p><em>source: https://observablehq.com/<span class="citation" data-cites="d3/choropleth">@d3/choropleth</span></em></p>
<hr>
<ul>
<li><a href="https://www.census.gov/content/dam/Census/data/developers/geoareaconcepts.pdf">Census Geographies - Hierarchy</a></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="http://i.imgur.com/ZgUAWP3.png" class="img-fluid figure-img"></p>
<figcaption><em>U.S. Census Geographies</em></figcaption>
</figure>
</div>
<p><em>source: https://learn.arcgis.com/en/related-concepts/united-states-census-geography.htm</em></p>
<hr>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Gerrymandering">Gerrymandering Definition</a></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Gerrymandering is a practice intended to establish an unfair political advantage for a particular party or group by manipulating district boundaries, which is most commonly used in first-past-the-post electoral systems.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Two principal tactics are used in gerrymandering: “cracking” (i.e.&nbsp;diluting the voting power of the opposing party’s supporters across many districts) and “packing” (concentrating the opposing party’s voting power in one district to reduce their voting power in other districts). The top-left diagram in the graphic is a form of cracking where the majority party uses its superior numbers to guarantee the minority party never attains a majority in any district.</p>
</div>
</div>
<p><img src="https://i.imgur.com/MX0crMA.png" class="img-fluid" alt="Gerrymander"> <em>source: Elkanah Tisdale (1771-1835) (often falsely attributed to Gilbert Stuart) - Originally published in the Boston Centinel, 1812.</em></p>
<hr>
<ul>
<li><a href="http://gispopsci.org/maup/">MAUP</a></li>
</ul>
<p><img src="https://i.imgur.com/OZN8k9j.png" class="img-fluid" alt="Scale and Zonal Effects"> <em>source: https://www.mdpi.com/2313-576X/2/3/17/htm</em></p>
<hr>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Histogram">Histogram</a></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>A histogram is an approximate representation of the distribution of numerical data. It was first introduced by Karl Pearson, sometimes referred to as the “Father of Statistics”. To construct a histogram, the first step is to “bin” (or “bucket”) the range of values—that is, divide the entire range of values into a series of intervals—and then count how many values fall into each interval.</p>
</div>
</div>
<p><img src="https://i.imgur.com/YgvhIMb.png" class="img-fluid" alt="Histogram"> <em>source: https://stackoverflow.com/questions/14482502/histogram-with-curve-in-r</em></p>
<p><img src="https://i.imgur.com/u3nVk8P.png" class="img-fluid" alt="Typical Histogram Shapes"> <em>source: https://en.wikipedia.org/wiki/Histogram</em></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://i.imgur.com/WrNQjTV.jpg" class="img-fluid figure-img"></p>
<figcaption><em>Classification Methods</em></figcaption>
</figure>
</div>
<p><em>source:http://arc-team-open-research.blogspot.com/2014/07/geometric-classification-method-in-qgis.html</em></p>
<ul>
<li><p><strong>EQUAL INTERVAL</strong> divides the data into equal size classes (e.g., 0-10, 10-20, 20-30, etc.) and works best on data that is generally spread across the entire range. <strong>Not suited for skewed data.</strong></p></li>
<li><p><strong>QUANTILES</strong> will create attractive maps that place an equal number of observations in each class: If you have 30 counties and 6 data classes, you’ll have 5 counties in each class. <strong>The problem with quantiles is that you can end up with classes that have very different numerical ranges (e.g., 1-4, 4-9, 9-250…the last class is huge).</strong></p></li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Quantile expanded to 10 class breaks = Deciles, i.e.&nbsp;percentages % which is some situations can be a valuable break presentation.</p>
</div>
</div>
<ul>
<li><p><strong>NATURAL BREAKS</strong> is a kind of <strong>“optimal” classification scheme</strong> that finds class breaks that (for a given number of classes) will minimize within-class variance and maximize between-class differences.</p></li>
<li><p><strong>MANUAL</strong> There are many times we need to <strong>manually set</strong> one or all of the class breaks.</p></li>
<li><p><strong>GEOMETRIC INTERVALS</strong> can handle highly skewed data ofter better than other methods. Geometric interval works best when the data is spread over a large area and is not well distributed.</p></li>
</ul>
<hr>
<ul>
<li><a href="https://academy.datawrapper.de/article/117-color-palette-for-your-map">Classification, Breaks and Color</a></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://i.imgur.com/PPp4pTh.png" class="img-fluid figure-img"></p>
<figcaption><em>Color for Choropleths</em></figcaption>
</figure>
</div>
<p><em>source: https://academy.datawrapper.de/article/117-color-palette-for-your-map</em></p>
<hr>
</section>
<section id="class-5-demonstration-labs-video-guides" class="level2">
<h2 class="anchored" data-anchor-id="class-5-demonstration-labs-video-guides">Class 5 Demonstration Labs + Video Guides:</h2>
<p><strong>Lab #1: The Geodatabase Format</strong></p>
<ul>
<li><p><a href="https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-data.2020.html#list-tab-8D0FFIBS8PJO7C8Z1I">US Census TIGER <code>.gdb</code></a></p></li>
<li><p><a href="https://www.dropbox.com/s/vqst2u1cfwhxboj/ACS_2020_5YR_COUNTY.gdb.zip?dl=1">Class 5 Lab Demonstration Data</a></p></li>
<li><p><code>.gdb</code> structure</p></li>
<li><p><strong>Part I: Importing and Working with the Geodatabase Format in QGIS:</strong></p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://vimeo.com/1011825924"><img src="c5_demo_files/img/p1.png" class="img-fluid figure-img"></a></p>
<figcaption><em>Part I: Importing and Working with the Geodatabase Format in QGIS</em></figcaption>
</figure>
</div>
<hr>
<p><strong>Lab #2: Data Normalization based on Populations</strong></p>
<ul>
<li>Data Normalization
<ul>
<li><p><a href="https://www.census.gov/quickfacts/fact/note/US/POP060210">US Census ‘land area’ definition</a></p></li>
<li><p><code>B01001_001E - Total Population</code></p></li>
<li><p><code>B01001_002E - Male Population</code></p></li>
<li><p><a href="https://api.census.gov/data/2020/acs/acs5/variables.html">Census variable api 2020</a></p></li>
</ul></li>
<li><strong>Part II: Data Normalization with QGIS (Densities &amp; Rates):</strong></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://vimeo.com/1011825424"><img src="c5_demo_files/img/p2.png" class="img-fluid figure-img"></a></p>
<figcaption><em>Part II: Data Normalization with QGIS (Densities &amp; Rates</em>)</figcaption>
</figure>
</div>
<hr>
<p><strong>Lab #3: Table Joins In QGIS</strong></p>
<ul>
<li><p>Join Column = <code>GEOID_Data</code> (geometry) + <code>GEOID</code> (tabular)</p></li>
<li><p><strong>Part III: Table Joins with QGIS:</strong></p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://vimeo.com/1011834345"><img src="c5_demo_files/img/p3.png" class="img-fluid figure-img"></a></p>
<figcaption><em>Part III: Table Joins with QGIS</em></figcaption>
</figure>
</div>
<hr>
<p><strong>Lab #4: Data Classification in QGIS</strong></p>
<ul>
<li><p>Classification Method Symbolization</p></li>
<li><p><strong>Part IV: Data Classification Methods for Choropleth mapping with QGIS:</strong></p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://vimeo.com/1011824500"><img src="c5_demo_files/img/p4.png" class="img-fluid figure-img"></a></p>
<figcaption><em>Part IV: Data Classification Methods for Choropleth mapping with QGIS</em></figcaption>
</figure>
</div>
</section>
<section id="class-5-links" class="level2">
<h2 class="anchored" data-anchor-id="class-5-links">Class 5 Links:</h2>
<ul>
<li><a href="https://tns-course-repositories.github.io/STGIS_UENV3200_UURB3210_SP26/agendas/c5_agenda.html">Class 5 Agenda</a></li>
<li><a href="https://tns-course-repositories.github.io/STGIS_UENV3200_UURB3210_SP26/demos/c5_demo.html">Class 5 Demonstration Lab 2 (not graded)</a></li>
<li><a href="https://tns-course-repositories.github.io/STGIS_UENV3200_UURB3210_SP26/assignments/c5_assignment.html">Class 5 Assignment</a></li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("^(?:http:|https:)\/\/www\.quarto\.org\/custom");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<script src="c5_demo_files/libs/quarto-html/zenscroll-min.js"></script>
</body></html>